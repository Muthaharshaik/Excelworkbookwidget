<?xml version="1.0" encoding="utf-8"?>
<widget
    id="lowcodelabs.excelworkbookwidget.ExcelWorkbookWidget"
    pluginWidget="true"
    needsEntityContext="false"
    offlineCapable="false"
    supportedPlatform="Web"
    xmlns="http://www.mendix.com/widget/1.0/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.mendix.com/widget/1.0/ ../node_modules/mendix/custom_widget.xsd">

    <name>Excel Workbook Widget</name>
    <description>
        Enterprise-grade Excel-like spreadsheet widget with multi-sheet support,
        formula engine, role-based access control, and auto-save.
    </description>
    <icon/>

    <properties>

        <!-- ═══════════════════════════════════════════════════════
             1. WORKBOOK DATA SOURCE
             Points directly to the Workbook entity.
             No DataView needed — widget has its own datasource.
        ════════════════════════════════════════════════════════ -->
        <propertyGroup caption="Workbook Data Source">

            <property key="workbookSource" type="datasource" isList="true" required="true">
                <caption>Workbook Source</caption>
                <description>
                    Select the Workbook entity. The widget reads all workbook
                    and sheet data directly from here. No DataView required.
                </description>
            </property>

            <property key="workbookId" type="attribute" dataSource="workbookSource" required="false">
                <caption>Workbook ID</caption>
                <description>Map to Workbook.WorkbookId (String)</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>

            <property key="workbookName" type="attribute" dataSource="workbookSource" required="false">
                <caption>Workbook Name</caption>
                <description>Map to Workbook.Name (String)</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>

            <property key="sheetsJson" type="attribute" dataSource="workbookSource" required="true">
                <caption>Sheets JSON</caption>
                <description>
                    Map to Workbook.SheetsJson (LongString). Contains all sheets
                    and their cell data as a JSON array. Widget parses and renders
                    all sheets. On every cell change the widget serializes the
                    updated sheet back and fires onSheetChange.
                </description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>

            <property key="isReadOnly" type="attribute" dataSource="workbookSource" required="false">
                <caption>Is Read Only</caption>
                <description>
                    Map to Workbook.IsReadOnly (Boolean). When true, the entire
                    workbook is locked. Per-sheet access is controlled via
                    isEditable inside sheetsJson.
                </description>
                <attributeTypes>
                    <attributeType name="Boolean"/>
                </attributeTypes>
            </property>

            <property key="currentUserId" type="attribute" dataSource="workbookSource" required="false">
                <caption>Current User ID</caption>
                <description>
                    Map to Workbook.CurrentUserId (String). Included in save
                    payloads for audit trail tracking.
                </description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>

        </propertyGroup>

        <!-- ═══════════════════════════════════════════════════════
             4. ACTIONS
             Mendix microflows wired here handle DB persistence.
             The widget fires these; Mendix handles the actual commit.
        ════════════════════════════════════════════════════════ -->
        <propertyGroup caption="Actions">

            <property key="onSheetChange" type="action" required="false">
                <caption>On Sheet Change (Auto-Save)</caption>
                <description>
                    Fired automatically after every cell edit (debounced 800ms).
                    Wire this to a microflow that reads the updated sheetsJson
                    attribute and commits the Sheet + SheetData objects to the DB.
                    This is the ONLY save mechanism — there is no manual Save button.
                </description>
            </property>

            <property key="onSheetTabChange" type="action" required="false">
                <caption>On Sheet Tab Change</caption>
                <description>
                    Optional. Fired when the user switches to a different sheet tab.
                    Wire this if Mendix needs to track which sheet is currently active.
                </description>
            </property>

        </propertyGroup>

        <!-- ═══════════════════════════════════════════════════════
             5. DISPLAY SETTINGS
             Visual configuration for the widget.
        ════════════════════════════════════════════════════════ -->
        <propertyGroup caption="Display Settings">

            <property key="gridHeight" type="integer" defaultValue="600">
                <caption>Grid Height (px)</caption>
                <description>
                    Height of the spreadsheet grid area in pixels. Default: 600.
                    Does not include the toolbar or tab bar height.
                </description>
            </property>

            <property key="showToolbar" type="boolean" defaultValue="true">
                <caption>Show Formatting Toolbar</caption>
                <description>
                    Show the formatting toolbar (bold, italic, colors, borders, merge).
                    Toolbar is automatically hidden when the active sheet is read-only.
                </description>
            </property>

            <property key="showWorkbookHeader" type="boolean" defaultValue="true">
                <caption>Show Workbook Name Header</caption>
                <description>
                    Show the workbook name in a header bar above the grid.
                </description>
            </property>

            <property key="rowHeaders" type="boolean" defaultValue="true">
                <caption>Show Row Numbers</caption>
                <description>Show row number headers on the left (1, 2, 3…)</description>
            </property>

            <property key="colHeaders" type="boolean" defaultValue="true">
                <caption>Show Column Letters</caption>
                <description>Show column letter headers on top (A, B, C…)</description>
            </property>

        </propertyGroup>

        <!-- SYSTEM -->
        <propertyGroup caption="General">
            <systemProperty key="Name"/>
            <systemProperty key="Visibility"/>
            <systemProperty key="TabIndex"/>
        </propertyGroup>

    </properties>

</widget>