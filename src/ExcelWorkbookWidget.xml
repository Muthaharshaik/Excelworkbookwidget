<?xml version="1.0" encoding="utf-8"?>
<widget
    id="lowcodelabs.excelworkbookwidget.ExcelWorkbookWidget"
    pluginWidget="true"
    needsEntityContext="true"
    offlineCapable="false"
    supportedPlatform="Web"
    xmlns="http://www.mendix.com/widget/1.0/"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.mendix.com/widget/1.0/ ../node_modules/mendix/custom_widget.xsd">

    <name>Excel Workbook Widget</name>
    <description>
        Excel-like spreadsheet widget. Place inside a DataView of the
        Spreadsheet entity. Reads and writes cell data via sheetJson attribute.
    </description>
    <icon/>

    <properties>

        <!-- ═══════════════════════════════════════════
             1. SHEET DATA
             Widget must be inside DataView of Spreadsheet entity.
        ════════════════════════════════════════════ -->
        <propertyGroup caption="Sheet Data">

            <property key="sheetId" type="attribute" required="false">
                <caption>Sheet ID</caption>
                <description>Map to Spreadsheet.sheetId (String)</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>

            <property key="sheetName" type="attribute" required="false">
                <caption>Sheet Name</caption>
                <description>Map to Spreadsheet.sheetName (String)</description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>

            <property key="sheetJson" type="attribute" required="true">
                <caption>Sheet JSON</caption>
                <description>
                    Map to Spreadsheet.sheetJson (String, Unlimited length).
                    Stores cell data for this sheet as JSON.
                    Widget writes updated JSON back here on every cell change.
                </description>
                <attributeTypes>
                    <attributeType name="String"/>
                </attributeTypes>
            </property>

        </propertyGroup>

        <!-- ═══════════════════════════════════════════
             2. ACCESS CONTROL
        ════════════════════════════════════════════ -->
        <propertyGroup caption="Access Control">

            <property key="currentUserId" type="expression" required="false" defaultValue="''">
                <caption>Current User ID</caption>
                <description>
                    Expression returning the current logged-in user's ID.
                    Example: toString($currentUser)
                    Used to verify the WorkBookAccess record belongs to this user.
                </description>
                <returnType type="String"/>
            </property>

            <property key="accessUserId" type="expression" required="false" defaultValue="''">
                <caption>Access Record User ID</caption>
                <description>
                    Expression returning the user ID from the WorkBookAccess record.
                    Example: toString($currentObject/WorkBookAccess_Account)
                    Widget compares this with Current User ID to verify ownership.
                </description>
                <returnType type="String"/>
            </property>

            <property key="permissionType" type="expression" required="false" defaultValue="'View'">
                <caption>Permission Type</caption>
                <description>
                    Expression returning the permission from WorkBookAccess.
                    Example: toString($currentObject/PermissionType)
                    Expected values: "Edit" or "View"
                    Only applied if Current User ID matches Access Record User ID.
                </description>
                <returnType type="String"/>
            </property>

            <property key="isAdmin" type="expression" required="false" defaultValue="false">
                <caption>Is Admin</caption>
                <description>
                    Expression returning true if current user is an admin.
                    Example: $currentUser/IsAdmin
                    Admins get full access — overrides permissionType completely.
                </description>
                <returnType type="Boolean"/>
            </property>

        </propertyGroup>

        <!-- ═══════════════════════════════════════════
             2. ACTIONS
        ════════════════════════════════════════════ -->
        <propertyGroup caption="Actions">

            <property key="onSheetChange" type="action" required="false">
                <caption>On Sheet Change (Auto-Save)</caption>
                <description>
                    Fired after every cell edit (debounced 800ms).
                    Widget writes new JSON to sheetJson attribute first,
                    then calls this action. Wire to a microflow that
                    commits the Spreadsheet object.
                </description>
            </property>

        </propertyGroup>

        <!-- ═══════════════════════════════════════════
             3. DISPLAY SETTINGS
        ════════════════════════════════════════════ -->
        <propertyGroup caption="Display Settings">

            <property key="gridHeight" type="integer" defaultValue="600">
                <caption>Grid Height (px)</caption>
                <description>Height of the spreadsheet grid in pixels.</description>
            </property>

            <property key="rowCount" type="integer" defaultValue="50">
                <caption>Row Count</caption>
                <description>
                    Number of rows to show in the grid.
                    Admin configures this per sheet. Default is 50.
                </description>
            </property>

            <property key="showToolbar" type="boolean" defaultValue="true">
                <caption>Show Formatting Toolbar</caption>
                <description>Show bold, italic, color, merge toolbar.</description>
            </property>

            <property key="showSheetName" type="boolean" defaultValue="true">
                <caption>Show Sheet Name Header</caption>
                <description>Show sheet name above the grid.</description>
            </property>

            <property key="rowHeaders" type="boolean" defaultValue="true">
                <caption>Show Row Numbers</caption>
                <description>Show row numbers on the left (1, 2, 3…)</description>
            </property>

            <property key="colHeaders" type="boolean" defaultValue="true">
                <caption>Show Column Letters</caption>
                <description>Show column letters on top (A, B, C…)</description>
            </property>

        </propertyGroup>

        <!-- SYSTEM -->
        <propertyGroup caption="General">
            <systemProperty key="Name"/>
            <systemProperty key="Visibility"/>
            <systemProperty key="TabIndex"/>
        </propertyGroup>

    </properties>

</widget>